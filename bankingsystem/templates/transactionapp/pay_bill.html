{% extends 'common_page.html' %}
{% load bootstrap %}

{% block title %}Pay Bill{% endblock title %}

{% block body_content %}
<style>
    body {
        font-family: 'Segoe UI', sans-serif;
        background-color: #f8f9fa;
        margin: 0;
        padding: 0;
    }
    .container {
        max-width: 960px;
        margin: 60px auto;
        background: #fff;
        padding: 40px;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        margin-top: 200px;
        margin-bottom: 300px;
        width: 100%;
    }
</style>

<div class="container">
    <div class="row">
        <div class="col-md-8 offset-md-2">

            {% if messages %}
                <div class="alert alert-info">
                    {% for message in messages %}
                        {{ message }}
                    {% endfor %}
                </div>
            {% endif %}

            <form method="POST" enctype="multipart/form-data" class="mt-4">
                {% csrf_token %}

                <!-- Bill Type Dropdown (required for first step) -->
                <div class="form-group mb-3">
                    <label for="bill_type_selector"><strong>Select Bill Type</strong></label>
                    <select name="bill_type" id="bill_type_selector" class="form-control" required>
                        <option value="">-- Select Bill Type --</option>
                        <option value="Electricity" {% if bill_type == "Electricity" %}selected{% endif %}>Electricity</option>
                        <option value="Cable" {% if bill_type == "Cable" %}selected{% endif %}>Cable</option>
                        <option value="Water" {% if bill_type == "Water" %}selected{% endif %}>Water</option>
                    </select>
                </div>

                <!-- Django Form: all fields rendered, grouped dynamically by JavaScript -->
                {% csrf_token %}
                <div id="form_fields_wrapper">
                    <div class="common-fields">
                        {{ form.amount|bootstrap }}
                        {{ form.phone_number|bootstrap }}
                        {{ form.account_pin|bootstrap }}
                        {{ form.account_number|bootstrap }}
                    </div>

                    <div class="bill-section electricity-fields" style="display: none;">
                        {{ form.electricity_type|bootstrap }}
                        {{ form.meter_number|bootstrap }}
                    </div>

                    <div class="bill-section cable-fields" style="display: none;">
                        {{ form.cable_type|bootstrap }}
                        {{ form.decoder_number|bootstrap }}
                        {{ form.months_of_sub|bootstrap }}
                        {{ form.request_type|bootstrap }}
                    </div>

                    <div class="bill-section water-fields" style="display: none;">
                        {{ form.water_bill_type|bootstrap }}
                        {{ form.water_service_number|bootstrap }}
                    </div>

                    <div class="form-group mb-3">
                        <label for="account_type_display"><strong>Account Type</strong></label>
                        <input type="text" id="account_type_display" class="form-control" readonly>
                    </div>
                    
                    <div class="form-group mb-3">
                        <label for="account_balance_display"><strong>Account Balance</strong></label>
                        <input type="text" id="account_balance_display" class="form-control" readonly>
                    </div>
                </div>

                {% comment %} <select name="account_type" class="form-control">
                    {% for account in accounts %}
                        <option value="{{ account.id }}">
                            {{ account.account_type }} - {{ account.account_number }} - ₦{{ account.account_balance }}
                        </option>
                    {% endfor %}
                </select> {% endcomment %}
                

                <div class="d-flex justify-content-center">
                    <input class="bc-white mt-2 ml-2 me-3 loginbutton" type="Submit" value="Submit">

                </div>
            </form>

        </div>
    </div>
</div>

<!-- JavaScript to dynamically show/hide fields -->
<script>
document.addEventListener("DOMContentLoaded", function () {
    const selector = document.getElementById("bill_type_selector");

    const sections = {
        Electricity: document.querySelector(".electricity-fields"),
        Cable: document.querySelector(".cable-fields"),
        Water: document.querySelector(".water-fields")
    };

    function updateFields(selected) {
        Object.values(sections).forEach(sec => sec.style.display = "none");
        if (sections[selected]) {
            sections[selected].style.display = "block";
        }
    }

    selector.addEventListener("change", function () {
        updateFields(this.value);
    });

    // Initialize on page load (if already selected)
    if (selector.value) {
        updateFields(selector.value);
    }

});
document.querySelector('form').addEventListener('submit', function (e) {
    console.log("Submitting form...");
});

document.addEventListener("DOMContentLoaded", function () {
    const accountSelect = document.getElementById("id_account_number");
    const typeInput = document.getElementById("account_type_display");
    const balanceInput = document.getElementById("account_balance_display");

    accountSelect.addEventListener("change", function () {
        const accountNumber = this.value;
        if (!accountNumber) return;

        fetch("{% url 'get_account_details' %}?account_number=" + accountNumber)
            .then(response => response.json())
            .then(data => {
                typeInput.value = data.account_type;
                balanceInput.value = `₦${data.account_balance}`;
            });
    });
});
</script>
{% endblock body_content %}


















{% comment %} {% extends 'common_page.html' %}

{% block title %}Pay Bill{% endblock title %}

{% load bootstrap %}
{% block body_content %}
<style>
    body {
        font-family: 'Segoe UI', sans-serif;
        background-color: #f8f9fa;
        margin: 0;
        padding: 0;
    }
    .container {
        max-width: 960px;
        margin: 60px auto;
        background: #fff;
        padding: 40px;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        margin-top: 300px;
        margin-bottom: 300px;
        width: 2000px;
    }
    h1 {
        text-align: center;
        color: #2c3e50;
        margin-bottom: 30px;
    }
    p {
        font-size: 1.1em;
        line-height: 1.7;
        color: #444;
    }
    ul {
        margin-top: 15px;
        margin-bottom: 15px;
    }
    li {
        margin: 8px 0;
    }
</style>
</head>
<body>
<div class="container">
    <div class="row">
        <div class="col-3"></div>
        <div class="col-md-6 col-12 col-offset-3">
            <p><span class="date text-pink text-size-30px mt-5">
                {% if messages %}
                    {% for message in messages %}
                        {{message}}
                    {% endfor %}
                {% endif %}

            </span>

            </p>
            <form method="post" class="mt-4", enctype="multipart/form-data">
                {% csrf_token %}
                {{ form.non_field_errors }}
                {{ form|bootstrap_horizontal:"col-lg-6" }}

                {% if bill_type %}
                    <!-- Step 2: Render PayBills_form -->
                    <input type="hidden" name="bill_type" value="{{ bill_type }}">
                {% endif %}

                <div class="d-flex justify-content-center">
                    <input class="bc-white mt-2 ml-2 me-3 loginbutton" type="Submit" value="Submit">

                </div>
            </form>

        </div>
        <div class="col-3"></div>
    </div>
        <div class="col-3"></div>
    </div>
</div>
</div>
</body>
</html>
{% endblock body_content %}
     {% endcomment %}